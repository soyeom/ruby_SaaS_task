# 画面仕様書

本システムは以下の画面で構成される。

1. ログイン画面  
2. サインアップ画面  
3. ワークスペース一覧画面  
4. タスク一覧・管理画面（フィルタ・進捗表示を含む）

---

## 1. ログイン画面

### 1.1 画面概要

- 役割  
  - 既存ユーザーが `login_id` と `password` を入力してログインする画面。
  - ログイン成功後、ワークスペース一覧画面へ遷移する。
- URL（例）  
  - `/login`

- 使用API  
  - `POST /login`

---

### 1.2 画面構成（主要要素）

- 画面タイトル：`ログイン`

- 入力フォーム
  - ログインID入力欄
  - パスワード入力欄

- ボタン
  - `ログイン` ボタン
  - `サインアップへ` リンク（サインアップ画面への遷移）

---

### 1.3 入力項目

| 項目名 | name属性例 | 型 | 必須 | 備考 |
|--------|------------|----|------|------|
| ログインID | login_id | text | 必須 | 半角英数字想定 |
| パスワード | password | password | 必須 | 画面上はマスク表示 |

---

### 1.4 バリデーション・エラー処理

#### (1) クライアント側

- ログインID、パスワードいずれかが未入力の場合  
  → ログインAPIを呼び出さずエラーメッセージを表示  
  - `ログインIDを入力してください。`
  - `パスワードを入力してください。`

---

#### (2) サーバー側

- `POST /login` 実行時  
  認証失敗（IDまたはパスワード不正）の場合：
  - HTTPステータス：**401 Unauthorized**
  - 表示メッセージ例：  
    `ログインに失敗しました。ログインIDまたはパスワードを確認してください。`

- その他サーバーエラー発生時：
  - 表示例：  
    `サーバーエラーが発生しました。管理者にお問い合わせください。`

---

#### (3) その他エラー

- 通信エラー時：  
  - 表示例：  
    `通信エラーが発生しました。しばらくしてから再度お試しください。`

---

### 1.5 画面遷移

- 正常ログイン時：  
  → `ワークスペース一覧画面` へ遷移

- 「サインアップへ」リンククリック時：  
  → `サインアップ画面` へ遷移

---

## 2. サインアップ画面

### 2.1 画面概要

- 役割  
  - 新規ユーザーがアカウントを作成する画面。
  - 登録完了後はログイン画面へ遷移する。

- URL（例）  
  - `/signup`

- 使用API  
  - `POST /signup`

---

### 2.2 画面構成（主要要素）

- 画面タイトル：`サインアップ`

- 入力フォーム
  - ログインID
  - パスワード
  - パスワード（確認用）

- ボタン
  - `登録` ボタン
  - `ログインへ` リンク

---

### 2.3 入力項目

| 項目名 | name属性例 | 型 | 必須 | 備考 |
|--------|------------|----|------|------|
| ログインID | login_id | text | 必須 | 一意である必要あり |
| パスワード | password | password | 必須 | バックエンド側で bcrypt 管理 |
| パスワード（確認） | password_conf | password | 必須 | password と一致必須 |

---

### 2.4 バリデーション・エラー処理

#### (1) クライアント側

- 入力必須チェック  
- `password` と `password_conf` が一致しない場合：  
  - `パスワード（確認）が一致しません。`

---

#### (2) サーバー側

- `POST /signup` 実行時  
  - `login_id` 重複の場合  
    - 表示例：`このログインIDは既に使用されています。`

  - その他バリデーションエラーの場合  
    - 表示例：`入力内容に誤りがあります。`

---

### 2.5 画面遷移

- 登録成功時  
  - `ログイン画面` に遷移  
  - 「登録が完了しました。」などのメッセージを表示

- 「ログインへ」リンククリック時  
  - `ログイン画面` へ遷移
  
---

## 3. ワークスペース一覧画面

### 3.1 画面概要

**役割**
- ログインユーザーが所属しているワークスペース一覧を表示する。
- 選択したワークスペースのタスク一覧画面へ遷移する。
- （任意）新規ワークスペースの作成を行う。

**対応API**
- `GET /workspaces` （一覧取得）
- `POST /workspaces` （新規作成）

**URL（例）**
- `/workspaces`

---

### 3.2 画面構成（主要要素）

- 画面タイトル  
  - `ワークスペース一覧`

- 要素構成  
  - 所属ワークスペース一覧（リスト or テーブル）  
    - ワークスペース名  
  - （任意）新規ワークスペース作成フォーム  
  - ログアウトボタン  

---

### 3.3 入力項目

#### (1) 一覧表示

**表示項目**

| 項目 | 説明 |
|------|------|
| ワークスペース名 | 所属しているワークスペースの名称 |

**操作**

- 行クリック、または「選択」ボタン押下でタスク一覧へ遷移  
  - `/workspaces/:id/tasks`

---

#### (2) 新規ワークスペース作成（任意機能）

| 項目名 | name属性例 | 型 | 必須 | 備考 |
|--------|-------------|------|------|------|
| ワークスペース名 | name | text | 必須 | 空文字は不可 |

**使用API**  
- `POST /workspaces`

**リクエスト例**
```json
{
  "name": "テストワークスペース"
}
```

### 3.4 バリデーション・エラー処理

#### (1) 新規作成時エラー

- ワークスペース名未入力  
  表示例：`ワークスペース名を入力してください。`

- サーバー側エラー（保存失敗）  
  表示例：`ワークスペースの作成に失敗しました。`

---

#### (2) 認証エラー

本システムは **セッション認証方式** を採用している。

- セッションが無効、または未ログイン状態の場合  
  表示例：`ログインが必要です。`  
  `/login` 画面へ遷移する。

---

### 3.5 画面遷移

| 操作 | 内容 |
|------|------|
| ワークスペース選択 | `/workspaces/:id/tasks` へ遷移 |
| ログアウトボタン押下 | セッション削除 → `/login` へ遷移 |

---

## 4. タスク一覧・管理画面

### 4.1 画面概要

- 役割  
  - 選択中のワークスペースに紐づくタスクの一覧表示・作成・編集・削除・状態変更を行う。
  - 担当者・ステータスによるフィルタリング機能を提供する。
  - Rakeバッチで集計された担当者別進捗を表示する。

- URL（例）  
  - `/workspaces/:workspace_id/tasks`

### 4.2 画面構成（主要要素）

1. **ヘッダー部**
   - 現在選択中のワークスペース名表示
   - ワークスペース一覧へ戻るリンク

2. **フィルタエリア**
   - 担当者セレクトボックス
   - ステータスセレクトボックス（`すべて / todo / doing / done`）

3. **タスク作成フォーム**
   - タイトル
   - 説明（任意）
   - 担当者
   - ステータス（初期値：todo）

4. **タスク一覧テーブル**
   - 項目例：
     - タイトル
     - 担当者名
     - 状態（todo / doing / done）
     - カテゴリ（あれば）
     - 編集ボタン
     - 削除ボタン
     - 完了切り替えボタン（またはチェックボックス）

5. **担当者別進捗表示（集計結果）**
   - テーブル項目例：
     - 担当者名
     - 総タスク数
     - 完了タスク数
     - 進捗率（%）

### 4.3 入力項目

**(1) フィルタ項目**

| 項目名 | name属性例 | 型 | 必須 | 備考 |
|--------|------------|----|------|------|
| 担当者フィルタ | assignee_id | select | 任意 | 「すべて」「各ユーザー」 |
| ステータスフィルタ | status | select | 任意 | 「すべて」「todo」「doing」「done」 |

**(2) タスク作成フォーム**

| 項目名 | name属性例 | 型 | 必須 | 備考 |
|--------|------------|----|------|------|
| タイトル | title | text | 必須 | タスク名 |
| 説明 | description | textarea | 任意 | 詳細説明 |
| 担当者 | assignee_id | select | 必須 | メンバー一覧から選択 |
| ステータス | status | select | 必須 | 初期値：todo（0／未着手） |

**(3) 編集時**

- 作成フォームと同様の項目を既存値で表示し、更新後 `PATCH /tasks/:id` を呼び出す。

### 4.4 バリデーション・エラー処理

- タスク作成（`POST /workspaces/:workspace_id/tasks`）
  - タイトル未入力
    - 例：`タイトルを入力してください。`
  - 担当者未選択
    - 例：`担当者を選択してください。`
- タスク更新（`PATCH /tasks/:id`）
  - サーバー側バリデーションエラー時
    - 例：`タスクの更新に失敗しました。入力内容を確認してください。`
- タスク削除（`DELETE /tasks/:id`）
  - エラー時
    - 例：`タスクの削除に失敗しました。`

- フィルタ
  - 無効なパラメータ（存在しないユーザーIDなど）が指定された場合
    - サーバー側では安全なデフォルト（全件 or ヒットなし）として処理
    - 画面上は「該当するタスクがありません。」などのメッセージ表示

- 認証エラー
  - JWT期限切れ・不正トークンの場合
    - 例：`認証情報が無効です。再度ログインしてください。`
    - ログイン画面へ遷移

### 4.5 ステータス変更操作

- 画面操作
  - 各タスク行に「ステータス変更」ボタンを配置する。
  - ボタン押下ごとに、ステータスを以下の順で循環させる：
    - todo（進行前） → doing（進行中） → done（完了） → todo …

- 動作
  - フロントエンドから `PATCH /tasks/:id` を呼び出し、status を更新する。
  - サーバー側では受け取った status をバリデーション後、DBに反映する。

- エラー処理
  - 更新失敗時：
    - 例：`ステータスの更新に失敗しました。`

### 4.6 担当者別進捗表示

- 取得API
  - 例：`GET /workspaces/:workspace_id/task_progress`
- 表示項目
  - 担当者名
  - 総タスク数
  - 完了タスク数
  - 進捗率（%）
- エラー時
  - 例：`進捗情報の取得に失敗しました。`

---

以上が本システムにおける画面構成および入力項目・エラー処理の仕様である。