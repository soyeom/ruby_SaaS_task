# 画面仕様書

本システムは以下の画面で構成される。

1. ログイン画面  
2. サインアップ画面  
3. ワークスペース一覧画面  
4. タスク一覧・管理画面（フィルタ・進捗表示を含む）

---

## 1. ログイン画面

### 1.1 画面概要

- 役割  
  - 既存ユーザーが `login_id` と `password` を入力してログインする画面。
  - ログイン成功後、ワークスペース一覧画面へ遷移する。
- URL（例）  
  - `/login`

### 1.2 画面構成（主要要素）

- 画面タイトル：`ログイン`
- 入力フォーム
  - ログインID入力欄
  - パスワード入力欄
- ボタン
  - `ログイン` ボタン
  - `サインアップへ` リンク（サインアップ画面への遷移）

### 1.3 入力項目

| 項目名 | name属性例 | 型 | 必須 | 備考 |
|--------|------------|----|------|------|
| ログインID | login_id | text | 必須 | 半角英数字想定 |
| パスワード | password | password | 必須 | 画面上はマスク表示 |

### 1.4 バリデーション・エラー処理

- クライアント側
  - ログインID、パスワードいずれかが未入力の場合、ログインAPIを呼び出さずエラーメッセージ表示
    - 例：`ログインIDを入力してください。`
    - 例：`パスワードを入力してください。`
- サーバー側
  - `POST /login` 実行時、認証失敗（IDまたはパスワード不正）の場合：
    - HTTP 401 または 400 を返却
    - 画面上メッセージ例：`ログインに失敗しました。ログインIDまたはパスワードを確認してください。`
- その他
  - ネットワークエラー時：
    - 例：`通信エラーが発生しました。しばらくしてから再度お試しください。`

### 1.5 画面遷移

- 正常ログイン時：
  - `ワークスペース一覧画面` へ遷移
- 「サインアップへ」リンククリック時：
  - `サインアップ画面` へ遷移

---

## 2. サインアップ画面

### 2.1 画面概要

- 役割  
  - 新規ユーザーがアカウントを作成する画面。
  - 登録完了後にログイン画面へ遷移、または自動ログインしてワークスペース一覧画面へ遷移（実装方針に応じて）。

- URL（例）  
  - `/signup`

### 2.2 画面構成（主要要素）

- 画面タイトル：`サインアップ`
- 入力フォーム
  - ログインID
  - パスワード
  - パスワード（確認用）
- ボタン
  - `登録` ボタン
  - `ログインへ` リンク

### 2.3 入力項目

| 項目名 | name属性例 | 型 | 必須 | 備考 |
|--------|------------|----|------|------|
| ログインID | login_id | text | 必須 | 一意である必要あり |
| パスワード | password | password | 必須 | 長さ制約：例）8文字以上など（任意） |
| パスワード（確認） | password_conf | password | 必須 | password と一致必須 |

### 2.4 バリデーション・エラー処理

- クライアント側
  - 未入力チェック
  - `password` と `password_conf` が一致しない場合はエラー表示  
    - 例：`パスワード（確認）が一致しません。`
- サーバー側
  - `POST /signup` 実行時
    - `login_id` の重複エラー  
      - 例：`このログインIDは既に使用されています。`
    - その他バリデーションエラー（フォーマット等）がある場合  
      - 例：`入力内容に誤りがあります。`
- エラーメッセージはフォーム上部または各フィールド下に表示する。

### 2.5 画面遷移

- 登録成功時：
  - パターンA：`ログイン画面` に遷移し、「登録が完了しました」等のメッセージ表示  
  - パターンB：自動的にログイン処理を行い、`ワークスペース一覧画面` に遷移（どちらかを仕様として選択）

---

## 3. ワークスペース一覧画面

### 3.1 画面概要

- 役割  
  - ログインユーザーが所属しているワークスペースの一覧を表示する。
  - 選択したワークスペースのタスク一覧画面へ遷移する。
  - （余裕があれば）新規ワークスペースの作成も行う。

- URL（例）  
  - `/workspaces`

### 3.2 画面構成（主要要素）

- 画面タイトル：`ワークスペース一覧`
- 要素
  - 所属ワークスペース一覧（リスト or テーブル）
    - ワークスペース名
  - （任意）新規ワークスペース作成フォーム
  - ログアウトボタン

### 3.3 入力項目

**(1) 一覧表示**

- 項目
  - ワークスペース名
- 操作
  - 行をクリック、もしくは「選択」ボタンでタスク画面へ遷移

**(2) 新規ワークスペース作成（任意機能）**

| 項目名 | name属性例 | 型 | 必須 | 備考 |
|--------|------------|----|------|------|
| ワークスペース名 | name | text | 必須 | 簡単な文字列 |

### 3.4 バリデーション・エラー処理

- 新規作成時（`POST /workspaces`）
  - name 未入力の場合  
    - 例：`ワークスペース名を入力してください。`
  - サーバー側エラー時  
    - 例：`ワークスペースの作成に失敗しました。`

- 認証エラー
  - JWTトークンが無効または期限切れの場合  
    - 例：`認証の有効期限が切れました。再度ログインしてください。`  
    - ログイン画面へリダイレクト

### 3.5 画面遷移

- ワークスペース行クリック：
  - `/workspaces/:id/tasks`（タスク一覧・管理画面）へ遷移
- ログアウトボタン：
  - ローカルに保存しているトークン削除
  - `/login` へ遷移

---

## 4. タスク一覧・管理画面

### 4.1 画面概要

- 役割  
  - 選択中のワークスペースに紐づくタスクの一覧表示・作成・編集・削除・状態変更を行う。
  - 担当者・ステータスによるフィルタリング機能を提供する。
  - Rakeバッチで集計された担当者別進捗を表示する。

- URL（例）  
  - `/workspaces/:workspace_id/tasks`

### 4.2 画面構成（主要要素）

1. **ヘッダー部**
   - 現在選択中のワークスペース名表示
   - ワークスペース一覧へ戻るリンク

2. **フィルタエリア**
   - 担当者セレクトボックス
   - ステータスセレクトボックス（`すべて / todo / done`）

3. **タスク作成フォーム**
   - タイトル
   - 説明（任意）
   - 担当者
   - ステータス（初期値：todo）

4. **タスク一覧テーブル**
   - 項目例：
     - タイトル
     - 担当者名
     - 状態（todo/done）
     - カテゴリ（あれば）
     - 編集ボタン
     - 削除ボタン
     - 完了切り替えボタン（またはチェックボックス）

5. **担当者別進捗表示（集計結果）**
   - テーブル項目例：
     - 担当者名
     - 総タスク数
     - 完了タスク数
     - 進捗率（%）

### 4.3 入力項目

**(1) フィルタ項目**

| 項目名 | name属性例 | 型 | 必須 | 備考 |
|--------|------------|----|------|------|
| 担当者フィルタ | assignee_id | select | 任意 | 「すべて」「各ユーザー」 |
| ステータスフィルタ | status | select | 任意 | 「すべて」「todo」「done」 |

**(2) タスク作成フォーム**

| 項目名 | name属性例 | 型 | 必須 | 備考 |
|--------|------------|----|------|------|
| タイトル | title | text | 必須 | タスク名 |
| 説明 | description | textarea | 任意 | 詳細説明 |
| 担当者 | assignee_id | select | 必須 | メンバー一覧から選択 |
| ステータス | status | select | 必須 | 初期値：todo（0） |

**(3) 編集時**

- 作成フォームと同様の項目を既存値で表示し、更新後 `PATCH /tasks/:id` を呼び出す。

### 4.4 バリデーション・エラー処理

- タスク作成（`POST /workspaces/:workspace_id/tasks`）
  - タイトル未入力
    - 例：`タイトルを入力してください。`
  - 担当者未選択
    - 例：`担当者を選択してください。`
- タスク更新（`PATCH /tasks/:id`）
  - サーバー側バリデーションエラー時
    - 例：`タスクの更新に失敗しました。入力内容を確認してください。`
- タスク削除（`DELETE /tasks/:id`）
  - エラー時
    - 例：`タスクの削除に失敗しました。`

- フィルタ
  - 無効なパラメータ（存在しないユーザーIDなど）が指定された場合
    - サーバー側では安全なデフォルト（全件 or ヒットなし）として処理
    - 画面上は「該当するタスクがありません。」などのメッセージ表示

- 認証エラー
  - JWT期限切れ・不正トークンの場合
    - 例：`認証情報が無効です。再度ログインしてください。`
    - ログイン画面へ遷移

### 4.5 完了状態切り替え

- 画面操作
  - タスク行ごとに「完了」ボタンまたはチェックボックスを配置
- 動作
  - `PATCH /tasks/:id` にて status を `todo ↔ done` に更新
- エラー処理
  - 更新失敗時
    - 例：`ステータスの更新に失敗しました。`

### 4.6 担当者別進捗表示

- 取得API
  - 例：`GET /workspaces/:workspace_id/task_progress`
- 表示項目
  - 担当者名
  - 総タスク数
  - 完了タスク数
  - 進捗率（%）
- エラー時
  - 例：`進捗情報の取得に失敗しました。`

---

以上が本システムにおける画面構成および入力項目・エラー処理の仕様である。